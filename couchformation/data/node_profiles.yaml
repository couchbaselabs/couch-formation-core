---
default:
  - provisioner: remote
    root: false
    exclude:
      - windows
      - macos
    commands:
      - curl -sfL https://raw.githubusercontent.com/couchbaselabs/host-prep-lib/main/bin/setup.sh | sudo -E bash -s - -s -p pyhostprep
  - provisioner: winrm
    root: true
    commands:
      - (New-Object Net.WebClient).DownloadFile("https://www.python.org/ftp/python/3.11.7/python-3.11.7-amd64.exe", "$env:Temp\python-3.11.7-amd64.exe")
      - & $env:Temp\python-3.11.7-amd64.exe /quiet InstallAllUsers=1 PrependPath=1
generic:
  - provisioner: remote
    root: true
    exclude:
      - windows
      - macos
    commands:
      - bundlemgr -b Base
cbs:
  - provisioner: remote
    root: true
    commands:
      - bundlemgr -b CBS
      - swmgr cluster create -n {{ SERVICE_NAME }} -s {{ SERVICES }} -g {{ NODE_ZONE }} -D /cbdata -l {{ PRIVATE_IP_LIST }}
      - swmgr cluster rebalance -l {{ PRIVATE_IP_LIST }}
  - provisioner: docker
    root: true
    commands:
      - curl -sfL https://raw.githubusercontent.com/couchbaselabs/host-prep-lib/main/bin/setup.sh | bash -s - -s -p pyhostprep
      - swmgr cluster create -n {{ SERVICE_NAME }} -s {{ SERVICES }}
sgw:
  - provisioner: remote
    root: true
    commands:
      - bundlemgr -b InstallSGW
      - swmgr gateway configure -l {{ CONNECT_LIST }}
      - bundlemgr -b EnableSGW
